!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).rexwebfontloaderplugin=n()}(this,function(){"use strict";function o(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}function a(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&e(t,n)}function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function e(t,n){return(e=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t})(t,n)}function f(t,n){return!n||"object"!=typeof n&&"function"!=typeof n?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):n}function c(i){return function(){var t,n=r(i);if(function(){if("undefined"!=typeof Reflect&&Reflect.construct&&!Reflect.construct.sham){if("function"==typeof Proxy)return 1;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),1}catch(t){return}}}()){var e=r(this).constructor;t=Reflect.construct(n,arguments,e)}else t=n.apply(this,arguments);return f(this,t)}}function h(t,n){var e=p.create(),i=e.getContext("2d"),o="8px ".concat(t);i.font=o;var s=Math.ceil(i.measureText(n).width),a=s,r=2*a;s===e.width&&r===e.height||(e.width=s,e.height=r),i.fillStyle="#000",i.fillRect(0,0,s,r),i.textBaseline="alphabetic",i.fillStyle="#fff",i.font=o,i.fillText(n,0,a);for(var f=i.getImageData(0,0,s,r).data,c=!1,h=0,l=f.length;h<l;h+=4)if(0<f[h]){c=!0;break}return p.remove(e),c}function l(t,n){return w(t)?(n=t).hasOwnProperty("config")?(n.type="webfont",n.url=""):n={key:"webfont",type:"webfont",url:"",config:n}:n={type:"webfont",url:"",key:t,config:n},this.addFile(new v(this,n)),this}var t,u=(function(nt){!function(){function i(t,n,e){return t.call.apply(t.bind,arguments)}function o(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var t=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(t,i),n.apply(e,t)}}return function(){return n.apply(e,arguments)}}function d(t,n,e){return(d=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?i:o).apply(null,arguments)}var r=Date.now||function(){return+new Date};function n(t,n){this.a=t,this.o=n||t,this.c=this.o.document}var f=!!window.FontFace;function c(t,n,e,i){if(n=t.c.createElement(n),e)for(var o in e)e.hasOwnProperty(o)&&("style"==o?n.style.cssText=e[o]:n.setAttribute(o,e[o]));return i&&n.appendChild(t.c.createTextNode(i)),n}function h(t,n,e){(t=(t=t.c.getElementsByTagName(n)[0])||document.documentElement).insertBefore(e,t.lastChild)}function e(t){t.parentNode&&t.parentNode.removeChild(t)}function g(t,n,e){n=n||[],e=e||[];for(var i=t.className.split(/\s+/),o=0;o<n.length;o+=1){for(var s=!1,a=0;a<i.length;a+=1)if(n[o]===i[a]){s=!0;break}s||i.push(n[o])}for(n=[],o=0;o<i.length;o+=1){for(s=!1,a=0;a<e.length;a+=1)if(i[o]===e[a]){s=!0;break}s||n.push(i[o])}t.className=n.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function s(t,n){for(var e=t.className.split(/\s+/),i=0,o=e.length;i<o;i++)if(e[i]==n)return!0;return!1}function l(t,n,e){function i(){a&&o&&(a(s),a=null)}n=c(t,"link",{rel:"stylesheet",href:n,media:"all"});var o=!1,s=null,a=e||null;f?(n.onload=function(){o=!0,i()},n.onerror=function(){o=!0,s=Error("Stylesheet failed to load"),i()}):setTimeout(function(){o=!0,i()},0),h(t,"head",n)}function u(t,n,e,i){var o=t.c.getElementsByTagName("head")[0];if(o){var s=c(t,"script",{src:n}),a=!1;return s.onload=s.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,e&&e(null),s.onload=s.onreadystatechange=null,"HEAD"==s.parentNode.tagName&&o.removeChild(s))},o.appendChild(s),setTimeout(function(){a||(a=!0,e&&e(Error("Script load timeout")))},i||5e3),s}return null}function p(){this.a=0,this.c=null}function v(t){return t.a++,function(){t.a--,a(t)}}function w(t,n){t.c=n,a(t)}function a(t){0==t.a&&t.c&&(t.c(),t.c=null)}function y(t){this.a=t||"-"}function m(t,n){this.c=t,this.f=4,this.a="n";var e=(n||"n4").match(/^([nio])([1-9])$/i);e&&(this.a=e[1],this.f=parseInt(e[2],10))}function b(t){var n=[];t=t.split(/,\s*/);for(var e=0;e<t.length;e++){var i=t[e].replace(/['"]/g,"");-1!=i.indexOf(" ")||/^\d/.test(i)?n.push("'"+i+"'"):n.push(i)}return n.join(",")}function x(t){return t.a+t.f}function j(t){var n="normal";return"o"===t.a?n="oblique":"i"===t.a&&(n="italic"),n}function T(t,n){this.c=t,this.f=t.o.document.documentElement,this.h=n,this.a=new y("-"),this.j=!1!==n.events,this.g=!1!==n.classes}function _(t){if(t.g){var n=s(t.f,t.a.c("wf","active")),e=[],i=[t.a.c("wf","loading")];n||e.push(t.a.c("wf","inactive")),g(t.f,e,i)}k(t,"inactive")}function k(t,n,e){t.j&&t.h[n]&&(e?t.h[n](e.c,x(e)):t.h[n]())}function S(){this.c={}}function P(t,n){this.c=t,this.f=n,this.a=c(this.c,"span",{"aria-hidden":"true"},this.f)}function F(t){h(t.c,"body",t.a)}function O(t){return"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+b(t.c)+";font-style:"+j(t)+";font-weight:"+t.f+"00;"}function C(t,n,e,i,o,s){this.g=t,this.j=n,this.a=i,this.c=e,this.f=o||3e3,this.h=s||void 0}function E(t,n,e,i,o,s,a){this.v=t,this.B=n,this.c=e,this.a=i,this.s=a||"BESbswy",this.f={},this.w=o||3e3,this.u=s||null,this.m=this.j=this.h=this.g=null,this.g=new P(this.c,this.s),this.h=new P(this.c,this.s),this.j=new P(this.c,this.s),this.m=new P(this.c,this.s),t=O(t=new m(this.a.c+",serif",x(this.a))),this.g.a.style.cssText=t,t=O(t=new m(this.a.c+",sans-serif",x(this.a))),this.h.a.style.cssText=t,t=O(t=new m("serif",x(this.a))),this.j.a.style.cssText=t,t=O(t=new m("sans-serif",x(this.a))),this.m.a.style.cssText=t,F(this.g),F(this.h),F(this.j),F(this.m)}y.prototype.c=function(t){for(var n=[],e=0;e<arguments.length;e++)n.push(arguments[e].replace(/[\W_]+/g,"").toLowerCase());return n.join(this.a)},C.prototype.start=function(){var o=this.c.o.document,s=this,a=r(),t=new Promise(function(e,i){!function n(){var t;r()-a>=s.f?i():o.fonts.load(j(t=s.a)+" "+t.f+"00 300px "+b(t.c),s.h).then(function(t){1<=t.length?e():setTimeout(n,25)},function(){i()})}()}),e=null,n=new Promise(function(t,n){e=setTimeout(n,s.f)});Promise.race([n,t]).then(function(){e&&(clearTimeout(e),e=null),s.g(s.a)},function(){s.j(s.a)})};var I={D:"serif",C:"sans-serif"},A=null;function N(){if(null===A){var t=/AppleWebKit\/([0-9]+)(?:\.([0-9]+))/.exec(window.navigator.userAgent);A=!!t&&(parseInt(t[1],10)<536||536===parseInt(t[1],10)&&parseInt(t[2],10)<=11)}return A}function W(t,n,e){for(var i in I)if(I.hasOwnProperty(i)&&n===t.f[I[i]]&&e===t.f[I[i]])return!0;return!1}function L(t){var n,e=t.g.a.offsetWidth,i=t.h.a.offsetWidth;(n=e===t.f.serif&&i===t.f["sans-serif"])||(n=N()&&W(t,e,i)),n?r()-t.A>=t.w?N()&&W(t,e,i)&&(null===t.u||t.u.hasOwnProperty(t.a.c))?B(t,t.v):B(t,t.B):setTimeout(d(function(){L(this)},t),50):B(t,t.v)}function B(t,n){setTimeout(d(function(){e(this.g.a),e(this.h.a),e(this.j.a),e(this.m.a),n(this.a)},t),0)}function D(t,n,e){this.c=t,this.a=n,this.f=0,this.m=this.j=!1,this.s=e}E.prototype.start=function(){this.f.serif=this.j.a.offsetWidth,this.f["sans-serif"]=this.m.a.offsetWidth,this.A=r(),L(this)};var R=null;function U(t){0==--t.f&&t.j&&(t.m?((t=t.a).g&&g(t.f,[t.a.c("wf","active")],[t.a.c("wf","loading"),t.a.c("wf","inactive")]),k(t,"active")):_(t.a))}function t(t){this.j=t,this.a=new S,this.h=0,this.f=this.g=!0}function $(t,n){this.c=t,this.a=n}function M(t,n){this.c=t,this.a=n}function q(t,n){this.c=t||"https://fonts.googleapis.com/css",this.a=[],this.f=[],this.g=n||""}D.prototype.g=function(t){var n=this.a;n.g&&g(n.f,[n.a.c("wf",t.c,x(t).toString(),"active")],[n.a.c("wf",t.c,x(t).toString(),"loading"),n.a.c("wf",t.c,x(t).toString(),"inactive")]),k(n,"fontactive",t),this.m=!0,U(this)},D.prototype.h=function(t){var n=this.a;if(n.g){var e=s(n.f,n.a.c("wf",t.c,x(t).toString(),"active")),i=[],o=[n.a.c("wf",t.c,x(t).toString(),"loading")];e||i.push(n.a.c("wf",t.c,x(t).toString(),"inactive")),g(n.f,i,o)}k(n,"fontinactive",t),U(this)},t.prototype.load=function(t){this.c=new n(this.j,t.context||this.j),this.g=!1!==t.events,this.f=!1!==t.classes,function(o,t,n){var e=[],i=n.timeout;!function(t){t.g&&g(t.f,[t.a.c("wf","loading")]),k(t,"loading")}(t);e=function(t,n,e){var i,o=[];for(i in n)if(n.hasOwnProperty(i)){var s=t.c[i];s&&o.push(s(n[i],e))}return o}(o.a,n,o.c);var s=new D(o.c,t,i);for(o.h=e.length,t=0,n=e.length;t<n;t++)e[t].load(function(t,n,e){var i,c,h,l,u,p;c=s,h=t,l=n,u=e,p=0==--(i=o).h,(i.f||i.g)&&setTimeout(function(){var t=u||null,n=l||{};if(0===h.length&&p)_(c.a);else{c.f+=h.length,p&&(c.j=p);var e,i=[];for(e=0;e<h.length;e++){var o=h[e],s=n[o.c],a=c.a,r=o;if(a.g&&g(a.f,[a.a.c("wf",r.c,x(r).toString(),"loading")]),k(a,"fontloading",r),(a=null)===R)if(window.FontFace){r=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent);var f=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);R=r?42<parseInt(r[1],10):!f}else R=!1;a=R?new C(d(c.g,c),d(c.h,c),c.c,o,c.s,s):new E(d(c.g,c),d(c.h,c),c.c,o,c.s,t,s),i.push(a)}for(e=0;e<i.length;e++)i[e].start()}},0)})}(this,new T(this.c,t),t)},$.prototype.load=function(a){var n=this,r=n.a.projectId,t=n.a.version;if(r){var f=n.c.o;u(this.c,(n.a.api||"https://fast.fonts.net/jsapi")+"/"+r+".js"+(t?"?v="+t:""),function(t){t?a([]):(f["__MonotypeConfiguration__"+r]=function(){return n.a},function t(){if(f["__mti_fntLst"+r]){var n,e=f["__mti_fntLst"+r](),i=[];if(e)for(var o=0;o<e.length;o++){var s=e[o].fontfamily;null!=e[o].fontStyle&&null!=e[o].fontWeight?(n=e[o].fontStyle+e[o].fontWeight,i.push(new m(s,n))):i.push(new m(s))}a(i)}else setTimeout(function(){t()},50)}())}).id="__MonotypeAPIScript__"+r}else a([])},M.prototype.load=function(t){var n,e,i=this.a.urls||[],o=this.a.families||[],s=this.a.testStrings||{},a=new p;for(n=0,e=i.length;n<e;n++)l(this.c,i[n],v(a));var r=[];for(n=0,e=o.length;n<e;n++)if((i=o[n].split(":"))[1])for(var f=i[1].split(","),c=0;c<f.length;c+=1)r.push(new m(i[0],f[c]));else r.push(new m(i[0]));w(a,function(){t(r,s)})};function G(t){this.f=t,this.a=[],this.c={}}var H={latin:"BESbswy","latin-ext":"çöüğş",cyrillic:"йяЖ",greek:"αβΣ",khmer:"កខគ",Hanuman:"កខគ"},V={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},z={i:"i",italic:"i",n:"n",normal:"n"},K=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function X(t,n){this.c=t,this.a=n}var J={Arimo:!0,Cousine:!0,Tinos:!0};function Q(t,n){this.c=t,this.a=n}function Y(t,n){this.c=t,this.f=n,this.a=[]}X.prototype.load=function(t){var n=new p,e=this.c,i=new q(this.a.api,this.a.text),o=this.a.families;!function(t,n){for(var e=n.length,i=0;i<e;i++){var o=n[i].split(":");3==o.length&&t.f.push(o.pop());var s="";2==o.length&&""!=o[1]&&(s=":"),t.a.push(o.join(s))}}(i,o);var s=new G(o);!function(t){for(var n=t.f.length,e=0;e<n;e++){var i=t.f[e].split(":"),o=i[0].replace(/\+/g," "),s=["n4"];if(2<=i.length){var a;if(a=[],r=i[1])for(var r,f=(r=r.split(",")).length,c=0;c<f;c++){var h;if((h=r[c]).match(/^[\w-]+$/))if(null==(u=K.exec(h.toLowerCase())))h="";else{if(h=null==(h=u[2])||""==h?"n":z[h],null==(u=u[1])||""==u)u="4";else var l=V[u],u=l||(isNaN(u)?"4":u.substr(0,1));h=[h,u].join("")}else h="";h&&a.push(h)}0<a.length&&(s=a),3==i.length&&(a=[],0<(i=(i=i[2])?i.split(","):a).length&&(i=H[i[0]])&&(t.c[o]=i))}for(t.c[o]||(i=H[o])&&(t.c[o]=i),i=0;i<s.length;i+=1)t.a.push(new m(o,s[i]))}}(s),l(e,function(t){if(0==t.a.length)throw Error("No fonts to load!");if(-1!=t.c.indexOf("kit="))return t.c;for(var n=t.a.length,e=[],i=0;i<n;i++)e.push(t.a[i].replace(/ /g,"+"));return n=t.c+"?family="+e.join("%7C"),0<t.f.length&&(n+="&subset="+t.f.join(",")),0<t.g.length&&(n+="&text="+encodeURIComponent(t.g)),n}(i),v(n)),w(n,function(){t(s.a,s.c,J)})},Q.prototype.load=function(a){var t=this.a.id,r=this.c.o;t?u(this.c,(this.a.api||"https://use.typekit.net")+"/"+t+".js",function(t){if(t)a([]);else if(r.Typekit&&r.Typekit.config&&r.Typekit.config.fn){t=r.Typekit.config.fn;for(var n=[],e=0;e<t.length;e+=2)for(var i=t[e],o=t[e+1],s=0;s<o.length;s++)n.push(new m(i,o[s]));try{r.Typekit.load({events:!1,classes:!1,async:!0})}catch(t){}a(n)}},2e3):a([])},Y.prototype.load=function(c){var t,n=this.f.id,e=this.c.o,h=this;n?(e.__webfontfontdeckmodule__||(e.__webfontfontdeckmodule__={}),e.__webfontfontdeckmodule__[n]=function(t,n){for(var e=0,i=n.fonts.length;e<i;++e){var o=n.fonts[e];h.a.push(new m(o.name,(s="font-weight:"+o.weight+";font-style:"+o.style,f=r=a=void 0,a=4,r="n",f=null,s&&((f=s.match(/(normal|oblique|italic)/i))&&f[1]&&(r=f[1].substr(0,1).toLowerCase()),(f=s.match(/([1-9]00|normal|bold)/i))&&f[1]&&(/bold/i.test(f[1])?a=7:/[1-9]00/.test(f[1])&&(a=parseInt(f[1].substr(0,1),10)))),r+a)))}var s,a,r,f;c(h.a)},u(this.c,(this.f.api||"https://f.fontdeck.com/s/css/js/")+((t=this.c).o.location.hostname||t.a.location.hostname)+"/"+n+".js",function(t){t&&c([])})):c([])};var Z=new t(window);Z.a.c.custom=function(t,n){return new M(n,t)},Z.a.c.fontdeck=function(t,n){return new Y(n,t)},Z.a.c.monotype=function(t,n){return new $(n,t)},Z.a.c.typekit=function(t,n){return new Q(n,t)},Z.a.c.google=function(t,n){return new X(n,t)};var tt={load:d(Z.load,Z)};nt.exports?nt.exports=tt:(window.WebFont=tt,window.WebFontConfig&&Z.load(window.WebFontConfig))}()}(t={exports:{}}),t.exports),p=Phaser.Display.Canvas.CanvasPool,d=Phaser.Loader.FILE_POPULATED,g=Phaser.Utils.Objects.GetValue,v=function(){a(n,Phaser.Loader.File);var t=c(n);function n(){return o(this,n),t.apply(this,arguments)}return s(n,[{key:"load",value:function(){if(this.state===d)this.loader.nextFile(this,!0);else{var t=this.config;this.testString=g(t,"testString",void 0),void 0!==this.testString&&(this.testInterval=g(t,"testInterval",20),this.fontTests={},delete t.testString,delete t.testInterval),t.active=this.onLoad.bind(this),t.inactive=this.onError.bind(this),t.fontactive=this.onFontActive.bind(this),t.fontinactive=this.onFontInactive.bind(this),u.load(t)}}},{key:"onLoad",value:function(){if(void 0===this.testString)this.loader.nextFile(this,!0);else{var t=function(){this.testFonts()?this.loader.nextFile(this,!0):setTimeout(t,this.testInterval)}.bind(this);t()}}},{key:"onError",value:function(){this.loader.nextFile(this,!1)}},{key:"onFontActive",value:function(t,n){var e;void 0!==this.testString&&void 0!==(e="string"==typeof this.testString?this.testString:this.testString[t])&&(this.fontTests[t]=e);this.loader.emit("webfontactive",this,t,n)}},{key:"onFontInactive",value:function(t,n){this.loader.emit("webfontinactive",this,t,n)}},{key:"testFonts",value:function(){var t=!0;for(var n in this.fontTests)h(n,this.fontTests[n])?delete this.fontTests[n]:t=!1;return t}}]),n}(),w=Phaser.Utils.Objects.IsPlainObject;return function(){a(i,Phaser.Plugins.BasePlugin);var e=c(i);function i(t){var n;return o(this,i),n=e.call(this,t),t.registerFileType("rexWebFont",l),n}return s(i,[{key:"addToScene",value:function(t){t.sys.load.rexWebFont=l}}]),i}()});
